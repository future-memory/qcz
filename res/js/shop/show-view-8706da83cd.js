!function(t){function e(i){if(s[i])return s[i].exports;var o=s[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var s={};e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){t.exports=s(3)},,,function(t,e){"use strict";function s(){$.ajax({url:"/index.php",type:"POST",data:{mod:"task",action:"auto_complete",taskid:13},dataType:"json",success:function(t){200==t.code&&mzbbsClient.showToast(t.data.task_msgs[0],0)}})}Vue.config.debug=!0,window.backpress=function(){},$(function(){function t(){return"0"!=uid}function e(t){_.each(i,function(e,s){e.value=t[e.code]})}info.price=parseInt(info.price),info.num=1,$.ajax({url:"https://bbs-act.meizu.cn/index.php",type:"get",data:{mod:"index",action:"single_address"},xhrFields:{withCredentials:!0},dataType:"json",success:function(t){var s=t.code,i=t.data;200==s?_.isEmpty(i)||(MainVM.allPassed=!0,e(i)):mzbbsClient.showToast(t.message,0)}});var i=[{type:"text",code:"name",txt:"姓名",errorDisplay:"姓名只能是汉字或字母(8个字以内)",rules:/^[A-Za-z\u4e00-\u9fa5]{1,8}$/},{type:"text",code:"phone",txt:"手机号",errorDisplay:"请填写正确的手机号",rules:/^1[3|4|5|7|8]\d{9}$/,readonly:!0},{type:"text",code:"address",txt:"详细地址",errorDisplay:"请填写地址信息(80字以内，不包含特殊字符)",rules:/^[^“’]{1,80}$/}];_.each(i,function(t,e){t.showError=!1,t.value=""}),Vue.component("main",{template:"#mainTemplate",props:["info"],methods:{showOrder:function(){if("0"!=this.info.count){if(!t())return void mzbbsClient.showDialogYesNoMsg("请先登录","mzbbsClient.bbsappLogin();","");this.$dispatch("orderToggle",!0)}}}}),Vue.component("order",{template:"#orderTemplate",props:["info","addressFieldsMap","allPassed"],data:function(){return{count:60,text:"获取验证码",canSend:!0,timer:"",numshow:!1,mycode:""}},methods:{sendCode:function(){var t=this;if(this.canSend){var e=[{id:this.info.id,count:this.info.num}];$.ajax({url:"https://bbs-act.meizu.cn/index.php",type:"post",data:{mod:"index",action:"send_code",goods_list:e},dataType:"json",xhrFields:{withCredentials:!0},success:function(e){var s=e.code;e.data;200==s?(t.countdown(),t.canSend=!1,t.numshow=!0,window.mzbbsClient&&mzbbsClient.showToast("发送成功",0)):401==s?mzbbsClient.showDialogYesNoMsg("请先登录","mzbbsClient.bbsappLogin();",""):window.mzbbsClient&&mzbbsClient.showToast(e.message,0)},error:function(){window.mzbbsClient&&mzbbsClient.showToast("服务器发生未知错误，请稍后再试～",0)}})}},countdown:function(){var t=this;this.text="已发送，",t.numshow=!0,this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){if(0===t.count)return void t.resetStatus();t.count--},1e3)},resetStatus:function(){this.text="获取验证码",this.numshow=!1,this.canSend=!0,this.count=60,this.timer&&clearInterval(this.timer)},showAddressEditor:function(){this.$dispatch("editorToggle",!0)},changeNum:function(t){"minus"==t?this.info.num>1&&this.info.num--:this.info.num<parseInt(this.info.limit)&&this.info.num++},validate:function(){var t=!0;return _.each(this.addressFieldsMap,function(e,s){e.showError=!(e.value&&e.rules.test(e.value.trim())),e.showError&&(t=!1)}),this.$dispatch("allPassed",t),t},commitOrder:function(){var t=this;if(!this.validate())return void mzbbsClient.showToast("请把地址信息填写完整",0);if(""==this.mycode)return void mzbbsClient.showToast("请填写验证码",0);var e=[{id:this.info.id,count:this.info.num}];this.info.num*parseInt(this.info.price)>this.info.userMb?mzbbsClient.showToast("你的煤球不够哦",0):$.ajax({url:api_url,type:"post",data:{mod:"shop",action:"submit_order",name:this.addressFieldsMap[0].value,phone:this.addressFieldsMap[1].value,address:this.addressFieldsMap[2].value,goods_list:e,code:this.mycode},dataType:"json",success:function(e){var i=e.code,o=(e.data,document.getElementsByClassName("verify")[0].getElementsByTagName("input")[0]);200==i?(t.resetStatus(),o.value="",window.mzbbsClient&&mzbbsClient.showToast("您的订单提交成功",0),t.info.count-=t.info.num,setTimeout(function(){t.$dispatch("orderToggle",!1),s()},2e3)):window.mzbbsClient&&mzbbsClient.showToast(e.message,0)},error:function(){mzbbsClient.showToast("服务器发生未知错误，请稍后再试",0)}})}}}),Vue.component("address-form",{template:"#addressFormTemplate",props:["addressFieldsMap"],methods:{saveAddress:function(){var t=this;this.validate()?($.ajax({url:api_url,type:"post",data:{mod:"shop",action:"update_address",name:this.addressFieldsMap[0].value,phone:this.addressFieldsMap[1].value,address:this.addressFieldsMap[2].value},dataType:"json",success:function(t){var e=t.code;t.data;200==e||mzbbsClient.showToast(t.message,0)}}),t.$dispatch("editorToggle",!1)):mzbbsClient.showToast("请正确填写每一项",0)},validateIt:function(t){var e=t.rules.test(t.value);t.showError=!e,e||this.$dispatch("allPassed",!1)},validate:function(){var t=!0;return _.each(this.addressFieldsMap,function(e,s){e.showError=!(e.value&&e.rules.test(e.value.trim())),e.showError&&(t=!1)}),this.$dispatch("allPassed",t),t}}}),window.MainVM=new Vue({el:"#container",data:{info:info,addressFieldsMap:i,orderShow:!1,editorShow:!1,allPassed:!1},events:{orderToggle:function(t){var e=this;e.orderShow=t,t?(window.mzbbsClient&&mzbbsClient.disableBack(!0),backpress=function(){e.$dispatch("orderToggle",!1)}):window.mzbbsClient&&mzbbsClient.disableBack(!1)},editorToggle:function(t){var e=this;e.editorShow=t,backpress=t?function(){e.$dispatch("editorToggle",!1)}:function(){e.$dispatch("orderToggle",!1)}},allPassed:function(t){this.allPassed=t}},ready:function(){}})})}]);